<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Upload Images & Download CSV</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ğŸ“¤ Upload Your Images</h1>
    <p>Select the images you want to upload. Once ready, download the list as a CSV file.</p>
    
    <input type="hidden" role="uploadcare-uploader" data-multiple="true" id="uploader" />

    <div class="buttons">
      <button onclick="downloadCSV()">ğŸ“¥ Download CSV</button>
      <button onclick="window.open('https://app.uploadcare.com/projects/d7638f5a88dbee59f6df/files/', '_blank')">
        ğŸ—‘ï¸ Manage Uploaded Images
      </button>
    </div>

    <small>Note: Only users with access to the Uploadcare dashboard can delete images manually.</small>
  </div>

 <script>
  UPLOADCARE_PUBLIC_KEY = 'd7638f5a88dbee59f6df';

  async function downloadCSV() {
    const widget = uploadcare.Widget('[role=uploadcare-uploader]');
    const result = await widget.value(); // Esto puede ser un solo archivo o un grupo

    let allUrls = [];

    // Si es un grupo
    if (result && typeof result.files === 'function') {
      const groupFiles = await result.files(); // Devuelve promesas
      for (const filePromise of groupFiles) {
        const file = await filePromise.promise(); // Esperamos la resoluciÃ³n del archivo
        allUrls.push(file.cdnUrl); // URL individual
      }
    } else {
      // Es uno o varios archivos individuales
      const filesArray = Array.isArray(result) ? result : [result];
      for (const filePromise of filesArray) {
        const file = await filePromise.promise();
        allUrls.push(file.cdnUrl);
      }
    }

    // Crear CSV
    let csv = 'image\n';
    allUrls.forEach(url => {
      csv += url + '\n';
    });

    const blob = new Blob([csv], { type: 'text/csv' });
    const urlBlob = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = urlBlob;
    a.download = 'images.csv';
    a.click();
    URL.revokeObjectURL(urlBlob);
  }

</script>

</body>
</html>
